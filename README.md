# Проект "Маркетинг"

## Цель и задачи
**Цель:** предсказать вероятность покупки в течение 90 дней.

**Задачи:**
- провести загрузку и предобработку данных;
- провести исследовательский анализ данных;
- разработать синтетические признаки;
- построить различные модели прогнозирования совершения покупки;
- выбрать лучшую модель (целевая метрика - ROC AUC);
- провести анализ результатов работы лучшей модели.

## Описание данных

Датасет **apparel-purchases**:
- client_id - идентификатор клиента;
- quantity - количество единиц товара;
- price - цена товара;
- category_ids - идентификаторы категорий;
- date - дата покупки;
- message_id - идентификатор сообщения из рассылки.

Датасет **apparel-messages**:
- bulk_campaign_id - идентификатор рассылки;
- client_id - идентификатор клиента;
- message_id - идентификатор сообщения;
- event - действие с сообщением (отправлено, открыто, покупка и т.д.);
- channel - канал рассылки;
- date - дата действия;
- created_at - дата-время полностью.

Датасет **full_campaign_daily_event**:
- date - дата;
- bulk_campaign_id - идентификатор рассылки;
- count_event - общее количество каждого события event;
- nunique_event - количество уникальных client_id в каждом событии.

Датасет **full_campaign_daily_event_channel**:
- date - дата;
- bulk_campaign_id - идентификатор рассылки;
- count_event*_channel* - общее количество каждого события по каналам;
- nunique_event*_channel* - количество уникальных client_id по событиям и каналам.

Датасет **apparel-target**:
- client_id - идентификатор клиента;
- target - клиент совершил покупку в целевом периоде.


## Результаты и выводы

Мы проанализировали данные заказчика и построили модель для предсказания вероятностя покупки в течение 90 дней.

В том числе:
1. Проведена загрузка и предобработка данных, в т.ч. обработан столбец category_ids и объединены датафреймы с данными о покупках и взаимодействиях.
2. Исследовательский анализ показал, что наибольшее влияние на целевой признак имеют признаки, связанные с датами покупок. Также установлен значительный дисбаланс по целевому признаку.
3. В качестве синтетических признаков использованы различные агрегирующие показатели: 
- сумма числа покупок в зависимости от основной (первой) категории;
- минимальные и макисмальные даты покупки и взаимодействия;
- интервалы покупок и взаимодействия (разница между максимальным и минимальным значением);
- число и сумма покупок;
- число взаимодействий.
4. Построены различные модели прогнозирования совершения покупки:
- простое дерево решений;
- случайный лес;
- LightGBM;
- CatBoost.
5. Лучший результат на тестовой выборке показали модели LightGBM с ROC AUC = 0.728 и CatBoost с ROC AUC = 0.733.
6. Проведен подбор гиперпараметров для данных моделей. В итоге лучший результат показала модель CatBoost с ROC AUC = 0.756.
7. Анализ результатов лучшей модели показал, что с порогом по умолчанию модель практически не может верно определить класс 1: метрика F1 составила 0.02. В связи с этим была проведена корректировка порога, после чего метрика F1 увеличилась до 0.08.
8. Анализ важности признаков показал, что на результаты модели наибольшее влияние оказывают следующие признаки:
- отношение числа покупок к числу кликов (обратное влияние);
- отношение числа кликов к числу открытых писем (прямое влияние);
- дата предыдущей покупки (прямое влияние);
- дата первого взаимодействия (обратное влияние для старых дат);
- дата первой покукпи (прямое влияние);
- средняя цена (обратное влияние).

Рекомендация заказчику: уточнить целевую метрику. Действительно ли для заказчика важна именно ROC AUC, которая плохо интерпретируется в бизнес-логике?
